&НаКлиенте
Функция СформироватьНастройку(Имя, Значение, ИдентификаторКлиента)
	
	Элемент = Новый Структура;
	Элемент.Вставить("Объект", "НастройкиСканированияДел/" + Имя);
	Элемент.Вставить("Настройка", ИдентификаторКлиента);
	Элемент.Вставить("Значение", Значение);
	Возврат Элемент;
	
КонецФункции	

&НаКлиенте
Процедура ОК(Команда)
	МассивСтруктур = Новый Массив;
	
	СистемнаяИнформация = Новый СистемнаяИнформация();
	ИдентификаторКлиента = СистемнаяИнформация.ИдентификаторКлиента;
	
	МассивСтруктур.Добавить (СформироватьНастройку("КаталогНаДиске", КаталогНаДиске, ИдентификаторКлиента));
	МассивСтруктур.Добавить (СформироватьНастройку("ПутьКАрхивуФайлов", ПутьКАрхивуФайлов, ИдентификаторКлиента));
	МассивСтруктур.Добавить (СформироватьНастройку("СохранятьВАрхив", СохранятьВАрхив, ИдентификаторКлиента));
	МассивСтруктур.Добавить (СформироватьНастройку("РайонПоУмолчаниюДляСкановДел", РайонПоУмолчаниюДляСкановДел, ИдентификаторКлиента));
	
	ОбщегоНазначения.ХранилищеОбщихНастроекСохранитьМассив(МассивСтруктур);
	Закрыть(КодВозвратаДиалога.ОК);
	
	ОбновитьПовторноИспользуемыеЗначения();
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ОбновитьСостояние();
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьСостояние()
	
	Элементы.ПутьКАрхивуФайлов.Видимость = СохранятьВАрхив;
	Элементы.РайонПоУмолчаниюДляСкановДел.Видимость = СохранятьВАрхив;
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Пропускаем инициализацию, чтобы гарантировать получение формы при передаче параметра "АвтоТест".
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;
	КонецЕсли;
	
	ИдентификаторКлиента = Параметры.ИдентификаторКлиента;
	
	СохранятьВАрхив = 
		ОбщегоНазначения.ХранилищеОбщихНастроекЗагрузить("НастройкиСканированияДел/СохранятьВАрхив", ИдентификаторКлиента);
	Если СохранятьВАрхив = Неопределено Тогда
		СохранятьВАрхив = Истина;
		ХранилищеОбщихНастроек.Сохранить("НастройкиСканированияДел/СохранятьВАрхив", ИдентификаторКлиента, СохранятьВАрхив);
	КонецЕсли;
	
	КаталогНаДиске = 
		ОбщегоНазначения.ХранилищеОбщихНастроекЗагрузить("НастройкиСканированияДел/КаталогНаДиске", ИдентификаторКлиента);
	Если КаталогНаДиске = Неопределено Тогда
		КаталогНаДиске = "";
		ХранилищеОбщихНастроек.Сохранить("НастройкиСканированияДел/КаталогНаДиске", ИдентификаторКлиента, КаталогНаДиске);
	КонецЕсли;
	
	ПутьКАрхивуФайлов = 
		ОбщегоНазначения.ХранилищеОбщихНастроекЗагрузить("НастройкиСканированияДел/ПутьКАрхивуФайлов", ИдентификаторКлиента);
	Если ПутьКАрхивуФайлов = Неопределено Тогда
		ПутьКАрхивуФайлов = "";
		ХранилищеОбщихНастроек.Сохранить("НастройкиСканированияДел/ПутьКАрхивуФайлов", ИдентификаторКлиента, ПутьКАрхивуФайлов);
	КонецЕсли;
	
	РайонПоУмолчаниюДляСкановДел = 
		ОбщегоНазначения.ХранилищеОбщихНастроекЗагрузить("НастройкиСканированияДел/РайонПоУмолчаниюДляСкановДел", ИдентификаторКлиента);
	Если РайонПоУмолчаниюДляСкановДел = Неопределено Тогда
		РайонПоУмолчаниюДляСкановДел = "";
		ХранилищеОбщихНастроек.Сохранить("НастройкиСканированияДел/РайонПоУмолчаниюДляСкановДел", ИдентификаторКлиента, РайонПоУмолчаниюДляСкановДел);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура КаталогНаДискеНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	
	РасширениеПодключено = ПодключитьРасширениеРаботыСФайлами();
	Если РасширениеПодключено Тогда
		
		Режим = РежимДиалогаВыбораФайла.ВыборКаталога;
		ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(Режим);
		ДиалогОткрытияФайла.ПолноеИмяФайла = "";
		ДиалогОткрытияФайла.Каталог = КаталогНаДиске;
		ДиалогОткрытияФайла.МножественныйВыбор = Ложь;
		ДиалогОткрытияФайла.Заголовок = НСтр("ru = 'Выберите путь каталога для загрузки файлов'");
		Если ДиалогОткрытияФайла.Выбрать() Тогда
			КаталогНаДиске = ДиалогОткрытияФайла.Каталог;
		КонецЕсли;
	КонецЕсли;		

КонецПроцедуры

&НаКлиенте
Процедура ПутьКАрхивуФайловНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	
	РасширениеПодключено = ПодключитьРасширениеРаботыСФайлами();
	Если РасширениеПодключено Тогда
		
		Режим = РежимДиалогаВыбораФайла.ВыборКаталога;
		ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(Режим);
		ДиалогОткрытияФайла.ПолноеИмяФайла = "";
		ДиалогОткрытияФайла.Каталог = ПутьКАрхивуФайлов;
		ДиалогОткрытияФайла.МножественныйВыбор = Ложь;
		ДиалогОткрытияФайла.Заголовок = НСтр("ru = 'Выберите путь каталога для архива файлов'");
		Если ДиалогОткрытияФайла.Выбрать() Тогда
			ПутьКАрхивуФайлов = ДиалогОткрытияФайла.Каталог;
		КонецЕсли;
	КонецЕсли;		
КонецПроцедуры

&НаКлиенте
Процедура СохранятьВАрхивПриИзменении(Элемент)
	ОбновитьСостояние();
КонецПроцедуры

&НаКлиенте
Процедура РайонПоУмолчаниюДляСкановДелНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	
	РасширениеПодключено = ПодключитьРасширениеРаботыСФайлами();
	Если РасширениеПодключено Тогда
		
		Режим = РежимДиалогаВыбораФайла.ВыборКаталога;
		ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(Режим);
		ДиалогОткрытияФайла.ПолноеИмяФайла = "";
		ДиалогОткрытияФайла.Каталог = РайонПоУмолчаниюДляСкановДел;
		ДиалогОткрытияФайла.МножественныйВыбор = Ложь;
		ДиалогОткрытияФайла.Заголовок = НСтр("ru = 'Выберите путь к архиву по районам'");
		Если ДиалогОткрытияФайла.Выбрать() Тогда
			РайонПоУмолчаниюДляСкановДел = ДиалогОткрытияФайла.Каталог;
		КонецЕсли;
	КонецЕсли;		
КонецПроцедуры
