
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если ЗначениеЗаполнено(Объект.Ссылка)
		И Объект.Транспорт.ФорматСообщения = ПредопределенноеЗначение("Справочник.ФорматыСообщенийСВД.ОператорЭДО1СТакском") Тогда
		
		Элементы.ГруппаОрганизации.Видимость = Ложь;		
		Элементы.ГруппаКорреспонденты.Видимость = Ложь;		
		Элементы.ГруппаВидыДокументов.Видимость = Ложь;		
		Элементы.ГруппаОграничения.Видимость = Ложь;		
		Элементы.ГруппаСоглашенияЭД.Видимость = Истина;		
		
	Иначе		
		
		Элементы.ГруппаОрганизации.Видимость = Истина;		
		Элементы.ГруппаКорреспонденты.Видимость = Истина;		
		Элементы.ГруппаВидыДокументов.Видимость = Истина;		
		Элементы.ГруппаОграничения.Видимость = Истина;		
		Элементы.ГруппаСоглашенияЭД.Видимость = Ложь;		
		
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьОбменЭД") Тогда
		СписокСоглашенийЧерезОЭДО.Параметры.УстановитьЗначениеПараметра("ДатаАктуальности", НачалоДня(ТекущаяДатаСеанса()));
		СписокСоглашенийЧерезОЭДО.Параметры.УстановитьЗначениеПараметра("Контрагент", Параметры.Контрагент);
		СписокСоглашенийЧерезОЭДО.Параметры.УстановитьЗначениеПараметра("Организация", Параметры.Организация);
	КонецЕсли;
	
	МаксимальныйРазмерВсехПередаваемыхФайловМб = Объект.МаксимальныйРазмерВсехПередаваемыхФайлов / (1024*1024);
	МаксимальныйРазмерПередаваемогоФайлаМб = Объект.МаксимальныйРазмерПередаваемогоФайла / (1024*1024);
	
КонецПроцедуры

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	ТекущийОбъект.МаксимальныйРазмерВсехПередаваемыхФайлов = МаксимальныйРазмерВсехПередаваемыхФайловМб * (1024*1024);
	ТекущийОбъект.МаксимальныйРазмерПередаваемогоФайла = МаксимальныйРазмерПередаваемогоФайлаМб * (1024*1024);
	
КонецПроцедуры

&НаКлиенте
Процедура ТранспортОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	Если ТранспортОператорЭДО1СТакском(ВыбранноеЗначение) Тогда
		
		Элементы.ГруппаОрганизации.Видимость = Ложь;		
		Элементы.ГруппаКорреспонденты.Видимость = Ложь;		
		Элементы.ГруппаВидыДокументов.Видимость = Ложь;		
		Элементы.ГруппаОграничения.Видимость = Ложь;		
		Элементы.ГруппаСоглашенияЭД.Видимость = Истина;		
		
	Иначе
		
		Элементы.ГруппаОрганизации.Видимость = Истина;		
		Элементы.ГруппаКорреспонденты.Видимость = Истина;		
		Элементы.ГруппаВидыДокументов.Видимость = Истина;		
		Элементы.ГруппаОграничения.Видимость = Истина;		
		Элементы.ГруппаСоглашенияЭД.Видимость = Ложь;		
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервереБезКонтекста
Функция ТранспортОператорЭДО1СТакском(ВыбранноеЗначение)

	Транспорт = ВыбранноеЗначение.ПолучитьОбъект();
	Возврат Транспорт.ФорматСообщения = ПредопределенноеЗначение("Справочник.ФорматыСообщенийСВД.ОператорЭДО1СТакском");
	
КонецФункции

&НаКлиенте
Процедура СписокСоглашенийЧерезОЭДОПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа)
	
	Отказ = Истина;
	
	Если Копирование Тогда
		ПараметрыФормы = Новый Структура;
		ПараметрыФормы.Вставить("ЗначениеКопирования", Элементы.СписокСоглашенийЧерезОЭДО.ТекущаяСтрока);
		ПараметрыФормы.Вставить("ПравилоОтправкиСообщенийСВД", Объект.Ссылка);
		ОткрытьФорму(
			"Справочник.СоглашенияОбИспользованииЭД.Форма.ФормаЭлементаЧерезОЭДО",
			ПараметрыФормы,
			Элементы.СписокСоглашенийЧерезОЭДО);
	Иначе
		ОтборДинамическогоСписка = ЭлектронныеДокументыКлиентСервер.ОтборДинамическогоСписка(
			СписокСоглашенийЧерезОЭДО);
		МассивЭлементовОрганизация = ОбщегоНазначенияКлиентСервер.НайтиЭлементыИГруппыОтбора(
			ОтборДинамическогоСписка, "Организация");
		ПараметрыФормы = Новый Структура;
		
		Организация = СписокСоглашенийЧерезОЭДО.Параметры.Элементы.Найти("Организация");
		
		Если Организация <> Неопределено
			И Организация.Использование
			И ЗначениеЗаполнено(Организация.Значение) Тогда
			
			ПараметрыФормы.Вставить("Организация", Организация.Значение);
				
		ИначеЕсли МассивЭлементовОрганизация.Количество() = 1
			И МассивЭлементовОрганизация[0].ВидСравнения = ВидСравненияКомпоновкиДанных.Равно
			И МассивЭлементовОрганизация[0].Использование Тогда
			
			ПараметрыФормы.Вставить("Организация", МассивЭлементовОрганизация[0].ПравоеЗначение);
		КонецЕсли;

		ПараметрыФормы.Вставить("ПравилоОтправкиСообщенийСВД", Объект.Ссылка);
		ОткрытьФорму("Справочник.СоглашенияОбИспользованииЭД.Форма.ПомощникНового",
			ПараметрыФормы, ЭтаФорма);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СписокСоглашенийЧерезОЭДОВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("Ключ", ВыбраннаяСтрока);
	ПараметрыФормы.Вставить("ПравилоОтправкиСообщенийСВД", Объект.Ссылка);
	ОткрытьФорму(
		"Справочник.СоглашенияОбИспользованииЭД.Форма.ФормаЭлементаЧерезОЭДО",
		ПараметрыФормы,
		Элементы.СписокСоглашенийЧерезОЭДО);
	
КонецПроцедуры

&НаКлиенте
Процедура СписокСоглашенийЧерезОЭДОПередНачаломИзменения(Элемент, Отказ)

	Отказ = Истина;
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("Ключ", Элемент.ТекущаяСтрока);
	ПараметрыФормы.Вставить("ПравилоОтправкиСообщенийСВД", Объект.Ссылка);
	ОткрытьФорму(
		"Справочник.СоглашенияОбИспользованииЭД.Форма.ФормаЭлементаЧерезОЭДО",
		ПараметрыФормы,
		Элементы.СписокСоглашенийЧерезОЭДО);
	
КонецПроцедуры
