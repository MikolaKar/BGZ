#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;
	КонецЕсли;
	
	ТолькоПросмотр = Параметры.ТолькоПросмотр;
	Если ТолькоПросмотр Тогда
		Элементы.ФормаГотово.Видимость = Ложь;
		Элементы.ФормаОтмена.Видимость = Ложь;
		Элементы.ФормаЗакрыть.Видимость = Истина;
	КонецЕсли;
	
	Для Каждого Статья из Параметры.СтатьиДвиженияДенежныхСредств Цикл
		Строка = ВыбранныеСтатьи.Добавить();
		Строка.СтатьяДвиженияДенежныхСредств = Статья;
	КонецЦикла;
	
	// Установим отбор, исключив выбранные статьи из общего списка.
	ОтборСписка = СтатьиДвиженияДенежныхСредств.Отбор.Элементы;
	ПоляОтбора = СтатьиДвиженияДенежныхСредств.Отбор.ДоступныеПоляОтбора.Элементы;
	ОтборПоСсылке = ОтборСписка.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ОтборПоСсылке.ВидСравнения = ВидСравненияКомпоновкиДанных.НеВСписке;
	ОтборПоСсылке.Использование = Истина;
	ОтборПоСсылке.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Ссылка");
	ОтборПоСсылке.ПравоеЗначение = Параметры.СтатьиДвиженияДенежныхСредств;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ПеренестиВправо(Команда)
	
	ТекущиеДанные = Элементы.СтатьиДвиженияДенежныхСредств.ТекущиеДанные;
	Если ТекущиеДанные <> Неопределено 
		И НЕ ТекущиеДанные.ЭтоГруппа Тогда
		ДобавитьСтатьюКВыбранным(ТекущиеДанные.Ссылка);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПеренестиВлево(Команда)
	
	ТекущиеДанные = Элементы.ВыбранныеСтатьи.ТекущиеДанные;
	Если ТекущиеДанные <> Неопределено Тогда
		УдалитьСтатьюИзВыбранных(ТекущиеДанные.СтатьяДвиженияДенежныхСредств);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура Готово(Команда)
	
	Результат = Новый Массив;
	Для каждого Строка из ВыбранныеСтатьи Цикл
		Результат.Добавить(Строка.СтатьяДвиженияДенежныхСредств);
	КонецЦикла;
	
	Закрыть(Результат);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийТаблицыФормыСтатьиДвиженияДенежныхСредств

&НаКлиенте
Процедура СтатьиДвиженияДенежныхСредствПриАктивизацииСтроки(Элемент)
	
	ТекущиеДанные = Элементы.СтатьиДвиженияДенежныхСредств.ТекущиеДанные;
	ДоступенВыбор = (ТекущиеДанные <> Неопределено) 
		И Не ТекущиеДанные.ЭтоГруппа
		И Не ТолькоПросмотр;
	Элементы.ПеренестиВправо.Доступность = ДоступенВыбор;
	Элементы.КонтекстноеМенюПеренестиВправо.Доступность = ДоступенВыбор;
	
КонецПроцедуры

&НаКлиенте
Процедура СтатьиДвиженияДенежныхСредствВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ТекущиеДанные = Элементы.СтатьиДвиженияДенежныхСредств.ТекущиеДанные;
	Если ТекущиеДанные <> Неопределено 
		И Не ТекущиеДанные.ЭтоГруппа 
		И Не ТолькоПросмотр Тогда
		ДобавитьСтатьюКВыбранным(ТекущиеДанные.Ссылка);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СтатьиДвиженияДенежныхСредствНачалоПеретаскивания(Элемент, ПараметрыПеретаскивания, 
	Выполнение)
	
	ТекущиеДанные = Элементы.СтатьиДвиженияДенежныхСредств.ТекущиеДанные;
	Если ТекущиеДанные = Неопределено 
		Или ТекущиеДанные.ЭтоГруппа
		Или ТолькоПросмотр Тогда
		Выполнение = Ложь;
	Иначе
		ПараметрыПеретаскивания.Значение = ТекущиеДанные.Ссылка;
		ПараметрыПеретаскивания.Действие = ДействиеПеретаскивания.Перемещение;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СтатьиДвиженияДенежныхСредствПроверкаПеретаскивания(Элемент, ПараметрыПеретаскивания, 
	СтандартнаяОбработка, Строка, Поле)
	
	СтандартнаяОбработка = Ложь;
	Если ТипЗнч(ПараметрыПеретаскивания.Значение) 
		=  Тип("СправочникСсылка.СтатьиДвиженияДенежныхСредств") Тогда
		ПараметрыПеретаскивания.ДопустимыеДействия = ДопустимыеДействияПеретаскивания.Перемещение;
	Иначе
		ПараметрыПеретаскивания.ДопустимыеДействия = ДопустимыеДействияПеретаскивания.НеОбрабатывать;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СтатьиДвиженияДенежныхСредствПеретаскивание(Элемент, ПараметрыПеретаскивания, 
	СтандартнаяОбработка, Строка, Поле)
	
	СтандартнаяОбработка = Ложь;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийТаблицыФормыВыбранныеСтатьи

&НаКлиенте
Процедура ВыбранныеСтатьиПриАктивизацииСтроки(Элемент)
	
	ТекущиеДанные = Элементы.ВыбранныеСтатьи.ТекущиеДанные;
	Элементы.ПеренестиВлево.Доступность = 
		Не ТолькоПросмотр
		И (ТекущиеДанные <> Неопределено);
	Элементы.КонтекстноеМенюПеренестиВлево.Доступность = 
		Не ТолькоПросмотр
		И (ТекущиеДанные <> Неопределено);
	
КонецПроцедуры

&НаКлиенте
Процедура ВыбранныеСтатьиВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ТекущиеДанные = Элементы.ВыбранныеСтатьи.ТекущиеДанные;
	Если ТекущиеДанные <> Неопределено
		И Не ТолькоПросмотр Тогда
		УдалитьСтатьюИзВыбранных(ТекущиеДанные.СтатьяДвиженияДенежныхСредств);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыбранныеСтатьиПеретаскивание(Элемент, ПараметрыПеретаскивания, СтандартнаяОбработка, 
		Строка, Поле)
	
	Если ТипЗнч(ПараметрыПеретаскивания.Значение) 
		= Тип("СправочникСсылка.СтатьиДвиженияДенежныхСредств") Тогда
		ПеренестиВправо(ПараметрыПеретаскивания.Значение);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыбранныеСтатьиНачалоПеретаскивания(Элемент, ПараметрыПеретаскивания, Выполнение)
	
	Если ТолькоПросмотр Тогда
		Выполнение = Ложь;
	Иначе
		ТекущиеДанные = Элементы.ВыбранныеСтатьи.ТекущиеДанные;
		ПараметрыПеретаскивания.Значение = ТекущиеДанные.СтатьяДвиженияДенежныхСредств;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыбранныеСтатьиПроверкаПеретаскивания(Элемент, ПараметрыПеретаскивания, СтандартнаяОбработка,
	Строка, Поле)
	
	СтандартнаяОбработка = Ложь;
	Если ТипЗнч(ПараметрыПеретаскивания.Значение) 
		= Тип("СправочникСсылка.СтатьиДвиженияДенежныхСредств") Тогда
		ПараметрыПеретаскивания.ДопустимыеДействия = ДопустимыеДействияПеретаскивания.Перемещение;
	Иначе
		ПараметрыПеретаскивания.ДопустимыеДействия = ДопустимыеДействияПеретаскивания.НеОбрабатывать;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыбранныеСтатьиОкончаниеПеретаскивания(Элемент, ПараметрыПеретаскивания, 
	СтандартнаяОбработка)
	
	Если ТипЗнч(ПараметрыПеретаскивания.Значение) 
		= Тип("СправочникСсылка.СтатьиДвиженияДенежныхСредств") Тогда
		ПеренестиВлево(ПараметрыПеретаскивания.Значение);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Добавляет статью в список выбранных, обновляя общий список.
//
// Параметры:
//   Статья - СправочникСсылка.СтатьиДвиженияДенежныхСредств - добавляемая статья.
//
&НаКлиенте
Процедура ДобавитьСтатьюКВыбранным(Статья)
	
	Для каждого Строка из ВыбранныеСтатьи Цикл
		Если Строка.СтатьяДвиженияДенежныхСредств = Статья Тогда
			Возврат;
		КонецЕсли;
	КонецЦикла;
	
	Строка = ВыбранныеСтатьи.Добавить();
	Строка.СтатьяДвиженияДенежныхСредств = Статья;
	
	ОбновитьОтборСписка();
	
КонецПроцедуры

// Удаляет статью из списка выбранных, обновляя общий список.
//
// Параметры:
//   Статья - СправочникСсылка.СтатьиДвиженияДенежныхСредств - удаляемая статья.
//
&НаКлиенте
Процедура УдалитьСтатьюИзВыбранных(Статья)
	
	Для каждого Строка из ВыбранныеСтатьи Цикл
		Если Строка.СтатьяДвиженияДенежныхСредств = Статья Тогда
			ВыбранныеСтатьи.Удалить(Строка);
			ОбновитьОтборСписка();
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

// Обновляет отбор динамического списка выбранными статьями.
//
&НаСервере
Процедура ОбновитьОтборСписка()
	
	МассивСтатей = Новый Массив;
	Для каждого СтрокаВыбранных из ВыбранныеСтатьи Цикл
		МассивСтатей.Добавить(СтрокаВыбранных.СтатьяДвиженияДенежныхСредств);
	КонецЦикла;
	
	ОтборСписка = СтатьиДвиженияДенежныхСредств.Отбор.Элементы;
	ОтборСписка[0].ПравоеЗначение = МассивСтатей; // единственный отбор
	
КонецПроцедуры

#КонецОбласти