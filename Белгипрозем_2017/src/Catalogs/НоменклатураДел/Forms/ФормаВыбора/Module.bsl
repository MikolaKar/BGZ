
&НаКлиенте
Перем ПерваяАктивизация;

//////////////////////////////////////////////////////////////////////////////// 
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("ТекущаяСтрока") И ЗначениеЗаполнено(Параметры.ТекущаяСтрока) Тогда 
		РазделПриОткрытии = Параметры.ТекущаяСтрока.Раздел;
		ПоказыватьДелаЗа = Параметры.ТекущаяСтрока.Год;
		Организация = Параметры.ТекущаяСтрока.Организация;
		Элементы.Организация.Видимость = Ложь;
		
	Иначе	
		РазделПриОткрытии = Справочники.РазделыНоменклатурыДел.ПустаяСсылка();
		
		Если ЗначениеЗаполнено(Параметры.Год) Тогда 
			ПоказыватьДелаЗа = Параметры.Год;
		Иначе
			ПоказыватьДелаЗа = Год(ТекущаяДата());
		КонецЕсли;
		
		Если ЗначениеЗаполнено(Параметры.Организация) Тогда 
			Организация = Параметры.Организация;
			Элементы.Организация.Видимость = Ложь;
		Иначе
			Организация = РаботаСОрганизациями.ПолучитьОрганизациюПоУмолчанию();
		КонецЕсли;
		
	КонецЕсли;
	
	Если Параметры.Свойство("Подразделение") И ЗначениеЗаполнено(Параметры.Подразделение) Тогда 
		Подразделение = Параметры.Подразделение;
		Элементы.Подразделение.Видимость = Ложь;
	КонецЕсли;
	
	// год
	Список.Параметры.УстановитьЗначениеПараметра("Год", ПоказыватьДелаЗа);
	Разделы.Параметры.УстановитьЗначениеПараметра("Год", ПоказыватьДелаЗа);
	
	// организация
	Если ЗначениеЗаполнено(Организация) Тогда 
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(Список.Отбор, "Организация", Организация);
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(Разделы.Отбор, "Организация", Организация);	
	Иначе
		ОбщегоНазначенияКлиентСервер.УдалитьЭлементыГруппыОтбора(Список.Отбор, "Организация");
		ОбщегоНазначенияКлиентСервер.УдалитьЭлементыГруппыОтбора(Разделы.Отбор, "Организация");	
	КонецЕсли;
	
	// Подразделение
	Если ЗначениеЗаполнено(Подразделение) Тогда 
		
		МассивПодразделений = Делопроизводство.ПолучитьПодразделениеИРодителей(Подразделение, Истина);
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(Разделы.Отбор,
			"Подразделение",
			МассивПодразделений,
			ВидСравненияКомпоновкиДанных.ВСписке);
			
		Группа = Список.Отбор.Элементы.Добавить(Тип("ГруппаЭлементовОтбораКомпоновкиДанных"));
		Группа.ТипГруппы = ТипГруппыЭлементовОтбораКомпоновкиДанных.ГруппаИли;
		Группа.Представление = "ГруппаПоиска";
		
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(Группа, "Раздел",, ВидСравненияКомпоновкиДанных.НеЗаполнено);

		ПустоеИПодразделение = Делопроизводство.ПолучитьПодразделениеИПустуюСсылку(Подразделение);	
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(Группа,
			"Раздел.Подразделение",
			ПустоеИПодразделение,
			ВидСравненияКомпоновкиДанных.ВСписке);

	Иначе 
		ОбщегоНазначенияКлиентСервер.УдалитьЭлементыГруппыОтбора(Список.Отбор, "Подразделение");	
		ОбщегоНазначенияКлиентСервер.УдалитьЭлементыГруппыОтбора(Разделы.Отбор, "Раздел.Подразделение");
	КонецЕсли;

	
	// раздел
	Элементы.Разделы.ТекущаяСтрока = РазделПриОткрытии;
	Список.Параметры.УстановитьЗначениеПараметра("Раздел", РазделПриОткрытии);
	
	// 
	НДДляВыбораПоВидуДок = Неопределено;
	Если Параметры.Свойство("ВидДокумента") И ЗначениеЗаполнено(Параметры.ВидДокумента) Тогда 
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
		|	НДВидыДокументов.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.НоменклатураДел.ВидыДокументов КАК НДВидыДокументов
		|ГДЕ
		|	НДВидыДокументов.ВидДокумента В ИЕРАРХИИ(&ВидДокумента)";
		
		Если ЗначениеЗаполнено(Организация) Тогда 
			Запрос.Текст = Запрос.Текст + " И Ссылка.Организация = &Организация ";
			Запрос.УстановитьПараметр("Организация", Организация);
		КонецЕсли;	
		
		Если ЗначениеЗаполнено(ПоказыватьДелаЗа) Тогда 
			Запрос.Текст = Запрос.Текст + " И Ссылка.Год = &Год ";
			Запрос.УстановитьПараметр("Год", ПоказыватьДелаЗа);
		КонецЕсли;	
		
		Запрос.УстановитьПараметр("ВидДокумента", Параметры.ВидДокумента);
		НДДляВыбораПоВидуДок = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Ссылка");
		
	КонецЕсли;	
	
	НДДляВыбораПоКорр = Неопределено;
	Если Параметры.Свойство("Корреспондент") И ТипЗнч(Параметры.Корреспондент) = Тип("СправочникСсылка.Корреспонденты") И ЗначениеЗаполнено(Параметры.Корреспондент) Тогда 
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
		|	НДКорреспонденты.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.НоменклатураДел.Корреспонденты КАК НДКорреспонденты
		|ГДЕ
		|	НДКорреспонденты.Корреспондент В ИЕРАРХИИ(&Корреспондент)";
		
		Если ЗначениеЗаполнено(Организация) Тогда 
			Запрос.Текст = Запрос.Текст + " И Ссылка.Организация = &Организация ";
			Запрос.УстановитьПараметр("Организация", Организация);
		КонецЕсли;	
		
		Если ЗначениеЗаполнено(ПоказыватьДелаЗа) Тогда 
			Запрос.Текст = Запрос.Текст + " И Ссылка.Год = &Год ";
			Запрос.УстановитьПараметр("Год", ПоказыватьДелаЗа);
		КонецЕсли;	
		
		Запрос.УстановитьПараметр("Корреспондент", Параметры.Корреспондент);
		НДДляВыбораПоКорр = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Ссылка");
		
	ИначеЕсли Параметры.Свойство("Корреспондент") И ТипЗнч(Параметры.Корреспондент) = Тип("Массив") И Параметры.Корреспондент.Количество() > 0 Тогда 
		
		Для Поз = 0 По Параметры.Корреспондент.ВГраница() Цикл
			
			Запрос = Новый Запрос;
			Запрос.Текст = 
			"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
			|	НДКорреспонденты.Ссылка КАК Ссылка
			|ИЗ
			|	Справочник.НоменклатураДел.Корреспонденты КАК НДКорреспонденты
			|ГДЕ
			|	НДКорреспонденты.Корреспондент В ИЕРАРХИИ(&Корреспондент)";
			
			Если ЗначениеЗаполнено(Организация) Тогда 
				Запрос.Текст = Запрос.Текст + " И Ссылка.Организация = &Организация ";
				Запрос.УстановитьПараметр("Организация", Организация);
			КонецЕсли;	
			
			Если ЗначениеЗаполнено(ПоказыватьДелаЗа) Тогда 
				Запрос.Текст = Запрос.Текст + " И Ссылка.Год = &Год ";
				Запрос.УстановитьПараметр("Год", ПоказыватьДелаЗа);
			КонецЕсли;
			
			Запрос.УстановитьПараметр("Корреспондент", Параметры.Корреспондент[Поз]);
			врНДДляВыбораПоКорр = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Ссылка");
			
			Если Поз = 0 Тогда 
				НДДляВыбораПоКорр = Новый Массив;
				Для Инд = 0 По врНДДляВыбораПоКорр.ВГраница() Цикл
					НДДляВыбораПоКорр.Добавить(врНДДляВыбораПоКорр[Инд]);
				КонецЦикла;	
			Иначе
				ВГраница = НДДляВыбораПоКорр.ВГраница();
				Для Инд = 0 По ВГраница Цикл
					Если врНДДляВыбораПоКорр.Найти(НДДляВыбораПоКорр[ВГраница-Инд]) = Неопределено Тогда 
						НДДляВыбораПоКорр.Удалить(ВГраница-Инд);
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;	
			
		КонецЦикла;
		
	КонецЕсли;
	
	
	НДДляВыбораПоВопрДеят = Неопределено;
	Если Параметры.Свойство("ВопросДеятельности") И ЗначениеЗаполнено(Параметры.ВопросДеятельности) Тогда 
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
		|	НДВопросы.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.НоменклатураДел.ВопросыДеятельности КАК НДВопросы
		|ГДЕ
		|	НДВопросы.ВопросДеятельности В ИЕРАРХИИ(&ВопросДеятельности)";
		
		Если ЗначениеЗаполнено(Организация) Тогда 
			Запрос.Текст = Запрос.Текст + " И Ссылка.Организация = &Организация ";
			Запрос.УстановитьПараметр("Организация", Организация);
		КонецЕсли;	
		
		Если ЗначениеЗаполнено(ПоказыватьДелаЗа) Тогда 
			Запрос.Текст = Запрос.Текст + " И Ссылка.Год = &Год ";
			Запрос.УстановитьПараметр("Год", ПоказыватьДелаЗа);
		КонецЕсли;
		
		Запрос.УстановитьПараметр("ВопросДеятельности", Параметры.ВопросДеятельности);
		НДДляВыбораПоВопрДеят = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Ссылка");
		
	КонецЕсли;
	
	
	Если НДДляВыбораПоВидуДок <> Неопределено Или НДДляВыбораПоКорр <> Неопределено Или НДДляВыбораПоВопрДеят <> Неопределено Тогда 
		
		Если НДДляВыбораПоВидуДок = Неопределено Тогда 
			НДДляВыбораПоВидуДок = Новый Массив;
		КонецЕсли;
		
		Если НДДляВыбораПоКорр = Неопределено Тогда 
			НДДляВыбораПоКорр = Новый Массив;
		КонецЕсли;
		
		Если НДДляВыбораПоВопрДеят = Неопределено Тогда 
			НДДляВыбораПоВопрДеят = Новый Массив;
		КонецЕсли;
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ ПЕРВЫЕ 1
		|	1 КАК Номер
		|ИЗ
		|	Справочник.НоменклатураДел КАК НоменклатураДел
		|ГДЕ
		|	НоменклатураДел.Ссылка В(&НДДляВыбораПоВидуДок)
		|	И НоменклатураДел.Ссылка В(&НДДляВыбораПоКорр)
		|	И НоменклатураДел.Ссылка В(&НДДляВыбораПоВопрДеят)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ ПЕРВЫЕ 1
		|	2
		|ИЗ
		|	Справочник.НоменклатураДел КАК НоменклатураДел
		|ГДЕ
		|	(НоменклатураДел.Ссылка В (&НДДляВыбораПоВидуДок)
		|				И НоменклатураДел.Ссылка В (&НДДляВыбораПоКорр)
		|				И 0 В
		|					(ВЫБРАТЬ
		|						КОЛИЧЕСТВО(*)
		|					ИЗ
		|						Справочник.НоменклатураДел.ВопросыДеятельности КАК ВопросыДеятельности
		|					ГДЕ
		|						ВопросыДеятельности.Ссылка = НоменклатураДел.Ссылка)
		|			ИЛИ НоменклатураДел.Ссылка В (&НДДляВыбораПоВидуДок)
		|				И НоменклатураДел.Ссылка В (&НДДляВыбораПоВопрДеят)
		|				И 0 В
		|					(ВЫБРАТЬ
		|						КОЛИЧЕСТВО(*)
		|					ИЗ
		|						Справочник.НоменклатураДел.Корреспонденты КАК Корреспонденты
		|					ГДЕ
		|						Корреспонденты.Ссылка = НоменклатураДел.Ссылка)
		|			ИЛИ НоменклатураДел.Ссылка В (&НДДляВыбораПоКорр)
		|				И НоменклатураДел.Ссылка В (&НДДляВыбораПоВопрДеят)
		|				И 0 В
		|					(ВЫБРАТЬ
		|						КОЛИЧЕСТВО(*)
		|					ИЗ
		|						Справочник.НоменклатураДел.ВидыДокументов КАК ВидыДокументов
		|					ГДЕ
		|						ВидыДокументов.Ссылка = НоменклатураДел.Ссылка))
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ ПЕРВЫЕ 1
		|	3
		|ИЗ
		|	Справочник.НоменклатураДел КАК НоменклатураДел
		|ГДЕ
		|	(НоменклатураДел.Ссылка В (&НДДляВыбораПоВидуДок)
		|				И 0 В
		|					(ВЫБРАТЬ
		|						КОЛИЧЕСТВО(*)
		|					ИЗ
		|						Справочник.НоменклатураДел.Корреспонденты КАК Корреспонденты
		|					ГДЕ
		|						Корреспонденты.Ссылка = НоменклатураДел.Ссылка)
		|				И 0 В
		|					(ВЫБРАТЬ
		|						КОЛИЧЕСТВО(*)
		|					ИЗ
		|						Справочник.НоменклатураДел.ВопросыДеятельности КАК ВопросыДеятельности
		|					ГДЕ
		|						ВопросыДеятельности.Ссылка = НоменклатураДел.Ссылка)
		|			ИЛИ НоменклатураДел.Ссылка В (&НДДляВыбораПоКорр)
		|				И 0 В
		|					(ВЫБРАТЬ
		|						КОЛИЧЕСТВО(*)
		|					ИЗ
		|						Справочник.НоменклатураДел.ВидыДокументов КАК ВидыДокументов
		|					ГДЕ
		|						ВидыДокументов.Ссылка = НоменклатураДел.Ссылка)
		|				И 0 В
		|					(ВЫБРАТЬ
		|						КОЛИЧЕСТВО(*)
		|					ИЗ
		|						Справочник.НоменклатураДел.ВопросыДеятельности КАК ВопросыДеятельности
		|					ГДЕ
		|						ВопросыДеятельности.Ссылка = НоменклатураДел.Ссылка)
		|			ИЛИ НоменклатураДел.Ссылка В (&НДДляВыбораПоВопрДеят)
		|				И 0 В
		|					(ВЫБРАТЬ
		|						КОЛИЧЕСТВО(*)
		|					ИЗ
		|						Справочник.НоменклатураДел.ВидыДокументов КАК ВидыДокументов
		|					ГДЕ
		|						ВидыДокументов.Ссылка = НоменклатураДел.Ссылка)
		|				И 0 В
		|					(ВЫБРАТЬ
		|						КОЛИЧЕСТВО(*)
		|					ИЗ
		|						Справочник.НоменклатураДел.Корреспонденты КАК Корреспонденты
		|					ГДЕ
		|						Корреспонденты.Ссылка = НоменклатураДел.Ссылка))";
		
		Запрос.УстановитьПараметр("НДДляВыбораПоВопрДеят", НДДляВыбораПоВопрДеят);
		Запрос.УстановитьПараметр("НДДляВыбораПоВидуДок", НДДляВыбораПоВидуДок);
		Запрос.УстановитьПараметр("НДДляВыбораПоКорр", НДДляВыбораПоКорр);
		
		Результат = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Номер");
		
		Если Результат.Найти(1) <> Неопределено Тогда 
			Список.ТекстЗапроса = Список.ТекстЗапроса + 
			" И СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоВидуДок) 
			| И СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоКорр) 
			| И СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоВопрДеят) ";
			
			Список.Параметры.УстановитьЗначениеПараметра("НДДляВыбораПоВопрДеят", НДДляВыбораПоВопрДеят);
			Список.Параметры.УстановитьЗначениеПараметра("НДДляВыбораПоВидуДок", НДДляВыбораПоВидуДок);
			Список.Параметры.УстановитьЗначениеПараметра("НДДляВыбораПоКорр", НДДляВыбораПоКорр);
			
		ИначеЕсли Результат.Найти(2) <> Неопределено Тогда 
			Список.ТекстЗапроса = Список.ТекстЗапроса + 
			"  И 	(СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоВидуДок)
			|			И СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоКорр)
			|				И 0 В
			|					(ВЫБРАТЬ
			|						КОЛИЧЕСТВО(*)
			|					ИЗ
			|						Справочник.НоменклатураДел.ВопросыДеятельности КАК ВопросыДеятельности
			|					ГДЕ
			|						ВопросыДеятельности.Ссылка = СправочникНоменклатураДел.Ссылка)
			|			ИЛИ СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоВидуДок)
			|				И СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоВопрДеят)
			|				И 0 В
			|					(ВЫБРАТЬ
			|						КОЛИЧЕСТВО(*)
			|					ИЗ
			|						Справочник.НоменклатураДел.Корреспонденты КАК Корреспонденты
			|					ГДЕ
			|						Корреспонденты.Ссылка = СправочникНоменклатураДел.Ссылка)
			|			ИЛИ СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоКорр)
			|				И СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоВопрДеят)
			|				И 0 В
			|					(ВЫБРАТЬ
			|						КОЛИЧЕСТВО(*)
			|					ИЗ
			|						Справочник.НоменклатураДел.ВидыДокументов КАК ВидыДокументов
			|					ГДЕ
			|						ВидыДокументов.Ссылка = СправочникНоменклатураДел.Ссылка)) ";
			
			Список.Параметры.УстановитьЗначениеПараметра("НДДляВыбораПоВопрДеят", НДДляВыбораПоВопрДеят);
			Список.Параметры.УстановитьЗначениеПараметра("НДДляВыбораПоВидуДок", НДДляВыбораПоВидуДок);
			Список.Параметры.УстановитьЗначениеПараметра("НДДляВыбораПоКорр", НДДляВыбораПоКорр);
			
		ИначеЕсли Результат.Найти(3) <> Неопределено Тогда 	
			Список.ТекстЗапроса = Список.ТекстЗапроса + 
			"  И	(СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоВидуДок)
			|				И 0 В
			|					(ВЫБРАТЬ
			|						КОЛИЧЕСТВО(*)
			|					ИЗ
			|						Справочник.НоменклатураДел.Корреспонденты КАК Корреспонденты
			|					ГДЕ
			|						Корреспонденты.Ссылка = СправочникНоменклатураДел.Ссылка)
			|				И 0 В
			|					(ВЫБРАТЬ
			|						КОЛИЧЕСТВО(*)
			|					ИЗ
			|						Справочник.НоменклатураДел.ВопросыДеятельности КАК ВопросыДеятельности
			|					ГДЕ
			|						ВопросыДеятельности.Ссылка = СправочникНоменклатураДел.Ссылка)
			|			ИЛИ СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоКорр)
			|				И 0 В
			|					(ВЫБРАТЬ
			|						КОЛИЧЕСТВО(*)
			|					ИЗ
			|						Справочник.НоменклатураДел.ВидыДокументов КАК ВидыДокументов
			|					ГДЕ
			|						ВидыДокументов.Ссылка = СправочникНоменклатураДел.Ссылка)
			|				И 0 В
			|					(ВЫБРАТЬ
			|						КОЛИЧЕСТВО(*)
			|					ИЗ
			|						Справочник.НоменклатураДел.ВопросыДеятельности КАК ВопросыДеятельности
			|					ГДЕ
			|						ВопросыДеятельности.Ссылка = СправочникНоменклатураДел.Ссылка)
			|			ИЛИ СправочникНоменклатураДел.Ссылка В (&НДДляВыбораПоВопрДеят)
			|				И 0 В
			|					(ВЫБРАТЬ
			|						КОЛИЧЕСТВО(*)
			|					ИЗ
			|						Справочник.НоменклатураДел.ВидыДокументов КАК ВидыДокументов
			|					ГДЕ
			|						ВидыДокументов.Ссылка = СправочникНоменклатураДел.Ссылка)
			|				И 0 В
			|					(ВЫБРАТЬ
			|						КОЛИЧЕСТВО(*)
			|					ИЗ
			|						Справочник.НоменклатураДел.Корреспонденты КАК Корреспонденты
			|					ГДЕ
			|						Корреспонденты.Ссылка = СправочникНоменклатураДел.Ссылка)) ";
			
			Список.Параметры.УстановитьЗначениеПараметра("НДДляВыбораПоВопрДеят", НДДляВыбораПоВопрДеят);
			Список.Параметры.УстановитьЗначениеПараметра("НДДляВыбораПоВидуДок", НДДляВыбораПоВидуДок);
			Список.Параметры.УстановитьЗначениеПараметра("НДДляВыбораПоКорр", НДДляВыбораПоКорр);
			
		Иначе
			Список.ТекстЗапроса = Список.ТекстЗапроса + 
			"   И 0 В
			|			(ВЫБРАТЬ
			|				КОЛИЧЕСТВО(*)
			|			ИЗ
			|				Справочник.НоменклатураДел.ВидыДокументов КАК ВидыДокументов
			|			ГДЕ
			|				ВидыДокументов.Ссылка = СправочникНоменклатураДел.Ссылка)
			|	И 0 В
			|			(ВЫБРАТЬ
			|				КОЛИЧЕСТВО(*)
			|			ИЗ
			|				Справочник.НоменклатураДел.Корреспонденты КАК Корреспонденты
			|			ГДЕ
			|				Корреспонденты.Ссылка = СправочникНоменклатураДел.Ссылка) 
			|	И 0 В
			|			(ВЫБРАТЬ
			|				КОЛИЧЕСТВО(*)
			|			ИЗ
			|				Справочник.НоменклатураДел.ВопросыДеятельности КАК ВопросыДеятельности
			|			ГДЕ
			|				ВопросыДеятельности.Ссылка = СправочникНоменклатураДел.Ссылка) ";
			
		КонецЕсли;	
		
	КонецЕсли;	
	
	
КонецПроцедуры

//////////////////////////////////////////////////////////////////////////////// 
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ

&НаКлиенте
Процедура ПоказыватьДелаЗаПриИзменении(Элемент)
	
	Список.Параметры.УстановитьЗначениеПараметра("Год", ПоказыватьДелаЗа);
	Разделы.Параметры.УстановитьЗначениеПараметра("Год", ПоказыватьДелаЗа);
	
КонецПроцедуры

&НаКлиенте
Процедура РазделыПриАктивизацииСтроки(Элемент)
	
	Если ПерваяАктивизация = Истина Или ПерваяАктивизация = Неопределено Тогда
		ПерваяАктивизация = Ложь;
		Возврат;
	КонецЕсли;
	
	ПодключитьОбработчикОжидания("ОбработкаОжидания", 0.2, Истина);
	
КонецПроцедуры

&НаКлиенте
Процедура ОрганизацияПриИзменении(Элемент)
	
	Если ЗначениеЗаполнено(Организация) Тогда 
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(Список.Отбор, "Организация", Организация);
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(Разделы.Отбор,	"Организация", Организация);
	Иначе
		ОбщегоНазначенияКлиентСервер.УдалитьЭлементыГруппыОтбора(Список.Отбор, "Организация");
		ОбщегоНазначенияКлиентСервер.УдалитьЭлементыГруппыОтбора(Разделы.Отбор, "Организация");
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПодразделениеПриИзменении(Элемент)
	
	Для Каждого Элемент Из Список.Отбор.Элементы Цикл
		Если Элемент.Представление = "ГруппаПоиска" Тогда
			Список.Отбор.Элементы.Удалить(Элемент);
			Возврат;
		КонецЕсли;	
	КонецЦикла;	

	Если ЗначениеЗаполнено(Подразделение) Тогда 
		МассивПодразделений = Делопроизводство.ПолучитьПодразделениеИРодителей(Подразделение);
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(Разделы.Отбор,
			"Подразделение",
			МассивПодразделений,
			ВидСравненияКомпоновкиДанных.ВСписке);
			
		Группа = Список.Отбор.Элементы.Добавить(Тип("ГруппаЭлементовОтбораКомпоновкиДанных"));
		Группа.ТипГруппы = ТипГруппыЭлементовОтбораКомпоновкиДанных.ГруппаИли;
		Группа.Представление = "ГруппаПоиска";
		
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(Группа, "Раздел",, ВидСравненияКомпоновкиДанных.НеЗаполнено);

		ПустоеИПодразделение = Делопроизводство.ПолучитьПодразделениеИПустуюСсылку(Подразделение);	
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(Группа,
			"Раздел.Подразделение",
			ПустоеИПодразделение,
			ВидСравненияКомпоновкиДанных.ВСписке);

	Иначе
		ОбщегоНазначенияКлиентСервер.УдалитьЭлементыГруппыОтбора(Список.Отбор, "Раздел.Подразделение");
		ОбщегоНазначенияКлиентСервер.УдалитьЭлементыГруппыОтбора(Разделы.Отбор, "Подразделение");
	КонецЕсли;

КонецПроцедуры

//////////////////////////////////////////////////////////////////////////////// 
// ПРОЦЕДУРЫ И ФУНКЦИИ  

&НаКлиенте
Процедура ОбработкаОжидания()
	
	Если Элементы.Разделы.ТекущаяСтрока <> Неопределено Тогда 
		Список.Параметры.УстановитьЗначениеПараметра("Раздел", Элементы.Разделы.ТекущаяСтрока);
	КонецЕсли;	
	
КонецПроцедуры

