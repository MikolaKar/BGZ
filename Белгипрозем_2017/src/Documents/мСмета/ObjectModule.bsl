
Процедура ОбработкаПроведения(Отказ, Режим)
	
	Если ЗначениеЗаполнено(Акт) Тогда
		// Это списание стоимости по Акту
		ВидДвижения = ВидДвиженияНакопления.Расход;
	Иначе
		// Это запоминание стоимости по годовой смете
	    ВидДвижения = ВидДвиженияНакопления.Приход;
	КонецЕсли; 

	// регистр Сметы Приход без НДС
	Движения.Сметы.Записывать = Истина;
	Если ОбъемРабот.Количество() = 0 Тогда
		// берем итоги
		Движение = Движения.Сметы.Добавить();
		Движение.ВидДвижения = ВидДвижения;
		Движение.Период = Дата;
		Движение.Договор = Договор;
		Движение.ВидРабот = ВидРабот;
		Движение.ОбъектРабот = ОбъектРабот;
		Движение.Смета = Смета;
		//Движение.СтадияРабот = ТекСтрокаОбъемРабот.СтадияРабот;
		Движение.Сумма = Сумма;
		Движение.НДС = НДС;
		Движение.Объем = Объем;
	Иначе
		Для Каждого ТекСтрокаОбъемРабот Из ОбъемРабот Цикл
			Движение = Движения.Сметы.Добавить();
			Движение.ВидДвижения = ВидДвижения;
			Движение.Период = Дата;
			Движение.Договор = Договор;
			Движение.ВидРабот = ВидРабот;
			Движение.ОбъектРабот = ОбъектРабот;
			Движение.Смета = Смета;
			Движение.СтадияРабот = ТекСтрокаОбъемРабот.СтадияРабот;
			Движение.Сумма = ТекСтрокаОбъемРабот.Сумма;
			Движение.НДС = 0;
			Движение.Объем = 0;
		КонецЦикла;
		
		// регистр Сметы Приход НДС по смете
		Движение = Движения.Сметы.Добавить();
		Движение.ВидДвижения = ВидДвижения;
		Движение.Период = Дата;
		Движение.Договор = Договор;
		Движение.ВидРабот = ВидРабот;
		Движение.ОбъектРабот = ОбъектРабот;
		Движение.Смета = Смета;
		//Движение.СтадияРабот = ТекСтрокаОбъемРабот.СтадияРабот;
		Движение.Сумма = 0;
		Движение.НДС = НДС;
		Движение.Объем = Объем;
	КонецЕсли; 
КонецПроцедуры
