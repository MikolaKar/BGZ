// Возвращает HTML представление письма
//
Функция Прочитать(Письмо) Экспорт
	
	Запись = СоздатьМенеджерЗаписи();
	Запись.Письмо = Письмо;
	Запись.Прочитать();
	Если Запись.Выбран() Тогда
		Возврат Запись.ТекстHTMLХранилище.Получить();
	КонецЕсли;
	
	Возврат Неопределено;
	
КонецФункции

// Устанавливает HTML представление письма
//
Процедура Записать(Письмо, ТекстHTML) Экспорт
	
	Запись = СоздатьМенеджерЗаписи();
	Запись.Письмо = Письмо;
	Запись.Прочитать();
	
	Запись.Письмо = Письмо;
	Запись.ТекстHTMLХранилище = Новый ХранилищеЗначения(ТекстHTML, Новый СжатиеДанных);
	Запись.ДатаЗаписи = ТекущаяДатаСеанса();
	
	Запись.Записать(Истина);
	
КонецПроцедуры

// Очищает HTML представление письма
//
Процедура Удалить(Письмо) Экспорт
	
	Запись = СоздатьМенеджерЗаписи();
	Запись.Письмо = Письмо;
	Запись.Прочитать();
	
	Если Запись.Выбран() Тогда
		Запись.Удалить();
	КонецЕсли;
	
КонецПроцедуры

// Очищает записи регистра с ДатаЗаписи < Дата
//
Процедура ОчиститьУстаревшиеЗаписи(Дата) Экспорт
	
	Запрос = Новый Запрос(
		"ВЫБРАТЬ
		|	HTMLПредставленияСодержанияПисем.Письмо
		|ИЗ
		|	РегистрСведений.HTMLПредставленияСодержанияПисем КАК HTMLПредставленияСодержанияПисем
		|ГДЕ
		|	HTMLПредставленияСодержанияПисем.ДатаЗаписи < &Дата");
	
	Запрос.УстановитьПараметр("Дата", Дата);
	
	РезультатЗапроса = Запрос.Выполнить();
	Если РезультатЗапроса.Пустой() Тогда
		Возврат;
	КонецЕсли;
	
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		Удалить(Выборка.Письмо);
	КонецЦикла;
	
КонецПроцедуры
